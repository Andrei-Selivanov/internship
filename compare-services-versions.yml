---
- name: Compare services versions
  hosts: win
  tasks:
    
    - name: Check service version file
      win_shell: Test-Path "{{ services_path }}"\"{{ item }}" $((Get-Content "{{ path_to_json_file }}" | ConvertFrom-Json)."{{ item }}")
      args:
        executable: powershell.exe
      register: file_exists
      loop: 
      - "{{ services_names }}"

    - name: Create version file if it not exist
      win_shell: |
      cd "{{ services_path }}"\"{{ item }}"
      echo > $((Get-Item "{{ services_path }}"\"{{ item	}}"\"{{ item }}".exe).VersionInfo.FileVersion)
      args:
        executable: powershell.exe
      loop:
      - "{{ services_names }}"
      when: file_exists == false 
