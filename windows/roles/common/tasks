---
- name: Compare services versions
  hosts: win
  tasks:
    
    - name: Check service version file
      win_shell: Test-Path "{{ services_path }}"\"{{ item[0] }}"\"{{ item [1] }}"
      args:
        executable: powershell.exe
      register: file_exists
      loop: 
      - "{{ services_names }}"
      - "{{ service_version }}"

    - name: Create version file if it not exist
      win_shell: |
      cd "{{ services_path }}"\"{{ item }}"
      echo > $((Get-Item "{{ services_path }}"\"{{ item	}}"\"{{ item }}".exe).VersionInfo.FileVersion)
      args:
        executable: powershell.exe
      loop:
      - "{{ services_names }}"
      when: file_exists == false 
  
    - name: Create list of services which is need to be update
      set_fact:
        need_update_service: "{{ item }}"
      loop: 
      - "{{ services_names }}"
      when: file_exists == false
